# 과평 준비

Category: BE

# 서블릿 url 매핑

Web Module 3.0 이전에는 web.xml 파일로 설정해야 했다.

이후에는 @어노테이션으로 매핑이 가능하다.

```java
@WebServlet("/ClassName")
public class ClassName extends HttpServlet {

}
```

Eclipse EE 에서 동적 웹에서 서블릿을 만들면 생성된다.

@WebServlet("/URL")의 URL 주소로 접속하면 

Tomcat 서버의 컨테이너가 매핑된 컨테이너가 매핑된 서블릿을 찾아 실행해 준다.

```java
@WebServlet("/main", "/list", "/ext")
public class ClassName extends HttpServlet {

}
```

서블릿 한 개에 여러개의 url 주소를 매핑하려면 아래 코드와 같이 배열 형태로 사용한다.

```xml
<servlet>
  <servlet-name>Name</servlet-name>
  <servlet-class>com.java.example.ClassName</servlet-class>
</servlet>

<servlet-mapping>
  <servlet-name>Name</servlet-name>
  <url-pattern>/class</url-pattern>
</servlet-mapping>

<servlet>
  <servlet-name>Name2</servlet-name>
  <servlet-class>com.java.example.ClassName</servlet-class>
</servlet>

<servlet-mapping>
  <servlet-name>Name2</servlet-name>
  <url-pattern>/main</url-pattern>
</servlet-mapping>
```

web.xml에는 위와 같이 설정한다.

서버 복사본이기에 publish를 해줘야 synchronized로 바뀐다.

# 서블릿 상속 관계 및 HttpServlet 라이프 사이클

### Servlet ?

자바 서블릿은 자바를 사용하여 웹페이지를 동적으로 생성하는 서버측 프로그램 혹은 그 사양을 말하며, 흔히 서블릿이라 불린다. 

JSP가 HTML 문서 안에 Java 코드를 포함하고 있는 반면, 

서블릿은 Java 코드 안에 HTML 을 포함하고 있다는 차이가 있다.

![Untitled](%E1%84%80%E1%85%AA%E1%84%91%E1%85%A7%E1%86%BC%20%E1%84%8C%E1%85%AE%E1%86%AB%E1%84%87%E1%85%B5%20092ebdc462c84b919ea45e889af4cfdc/Untitled.png)

![Untitled](%E1%84%80%E1%85%AA%E1%84%91%E1%85%A7%E1%86%BC%20%E1%84%8C%E1%85%AE%E1%86%AB%E1%84%87%E1%85%B5%20092ebdc462c84b919ea45e889af4cfdc/Untitled%201.png)

Servlet을 구현하는 Generic > GET / POST를 구현하는 Http > 그 것을 상속 받아 내 서블릿을 만든다.

### 라이프 사이클

서블릿 클래스는 자바 클래스와 다르게 main method가 없다. 즉 객체의 생성부터 사용의 주체가 사용자가 아닌 서블릿 컨테이너에게 있다.

클라이언트가 요청(request)를 하게 되면 컨테이너는 서블릿 객체를 생성하고, 초기화 하며 요청에 대한 처리를 하게 된다. 또한 서블릿 객체가 필요 없게 되면 제거하는 일까지 컨테이너가 담당하게 된다.

![Untitled](%E1%84%80%E1%85%AA%E1%84%91%E1%85%A7%E1%86%BC%20%E1%84%8C%E1%85%AE%E1%86%AB%E1%84%87%E1%85%B5%20092ebdc462c84b919ea45e889af4cfdc/Untitled%202.png)

즉 클라이언트 요청에 대해  생성자 호출 ( > 초기화 )

service()는 매번 한번만 실행 됨.

*init, destroy는 꼭 필요한게 아니라면 만들 필요가 없다.

# 서블릿 객체, 주요 메서드

### 기본객체

![Untitled](%E1%84%80%E1%85%AA%E1%84%91%E1%85%A7%E1%86%BC%20%E1%84%8C%E1%85%AE%E1%86%AB%E1%84%87%E1%85%B5%20092ebdc462c84b919ea45e889af4cfdc/Untitled%203.png)

![Untitled](%E1%84%80%E1%85%AA%E1%84%91%E1%85%A7%E1%86%BC%20%E1%84%8C%E1%85%AE%E1%86%AB%E1%84%87%E1%85%B5%20092ebdc462c84b919ea45e889af4cfdc/Untitled%204.png)

### 주요 메서드

**HttpServletRequest**

| getParameter(String) | client가 보내준 값이 저장된 명칭이 매개변수와 같은 명칭에 저장된 값을 불러오는 매소드 |
| --- | --- |
| getParameterNames() | client가 보내준 값을 저장한 명칭(key)을 불러오는 메소드 |
| getParameterValues(String) | client가 보내준 값이 여러개일 경우 그 값을 배열로 불러오는 메소드 (key제외) |
| getParameterMap() | client가 보내준 값이 전체를 Map방식으로 불러오는 메소드 |
| setAttribute(String.object) | request객체에 전달하고 싶은 값을 String 이름으로 Object타입으로 저장하는 메소드
ex) request.setAttribute("객체명", 객체); 
key와 value형식으로 전달 |
| getAttribute(String) | 매개변수와 동일한 객체 속상값을 불러오는 메소드
ex)  request.getAttribute("객체") |
| removeAttibute(String) | request객체에 저장되어 매개변수와 동일한 속성값을 삭제하는 메소드 |
| setCharacterEncoding(String) | 전송받은 reques객체의 값들의 CharaterSet을 설정해주는 메소드
ex) request.setCharacterEncoding("UTF-8"); |
| getRequestDispatcher(String) | 컨데이너내에서 request, response객체를 전송하여 처리할 컨포넌트(jsp 파일 등)를 불러오는 메소드로 forward()메소드와 같이 사용 |

**HttpServletResponse**

| setContentType(String) | 응답으로 작성하는 페이지의 MIME type을 정하는 메소드
ex) setContentType("text/html");
setContentType("text/plain"); |
| --- | --- |
| setCharacterEncoding(String) | 응답하는 데이터의 characterSet을 지정해주는 메소드 |
| getWriter() | 문자를 페이지에 전송을 위한 Stream을 가져오는 메소드 |
| getOutputStream() | byte단위로 페이지에 전송을 위한 Stream을 가져오는 메소드 |
| sendResdirect(String) | client가 매개변수의 페이지를 다시 서버에 요청하게 하는 메소드 |

# 페이지 이동 관련 객체 및 메서드

### Web Page 이동

![Untitled](%E1%84%80%E1%85%AA%E1%84%91%E1%85%A7%E1%86%BC%20%E1%84%8C%E1%85%AE%E1%86%AB%E1%84%87%E1%85%B5%20092ebdc462c84b919ea45e889af4cfdc/Untitled%205.png)

### forward, sendRedirect 차이

# 클라이언트 요청방식,
서블릿에서의 처리방법,
에러 응답 코드

![Untitled](%E1%84%80%E1%85%AA%E1%84%91%E1%85%A7%E1%86%BC%20%E1%84%8C%E1%85%AE%E1%86%AB%E1%84%87%E1%85%B5%20092ebdc462c84b919ea45e889af4cfdc/Untitled%206.png)

서블릿은 요청에 대해 html 로 응답한다.

작성된 jsp로 이동시키거나 html 형식으로 작성.

### form 태그 속성과 질의 문자열

**action 속성** : submit 버튼 클릭했을 때, 웹 서버에서 요청을 처리할 웹 컴포넌트를 지정한다. html, jsp, servlet 모두 설정할 수 있다.

**method 속성** : 웹 브라우저에서 웹 서버로 요청하는 처리 방법을 GET, POST 등으로 지정한다.

**name 속성** : 요소에 아이디나 클래스처럼 이름을 붙일 수 있는 속성인데, 질의문자열을 전달할때 사용되므로 중요한 속성이다. 체크박스 타입일 경우 하나의 그룹은 다 같은 이름을 지정해야 한다. <select>는 옵션 태그가 아닌 셀렉트 태그에 네임을 지정한다.

### 요청정보 한글처리

`request.setCharacterEncoding("utf-8");`

일단 클라이언트가 보낸 데이터를 한글로 먼저 인코딩 처리하고 데이터를 추출해서 사용해야 한다.

### ****요청 파라미터 처리 메서드****

| getParameter(String) | client가 보내준 값이 저장된 명칭이 매개변수와 같은 명칭에 저장된 값을 불러오는 매소드 |
| --- | --- |
| getParameterNames() | client가 보내준 값을 저장한 명칭(key)을 불러오는 메소드 |
| getParameterValues(String) | client가 보내준 값이 여러개일 경우 그 값을 배열로 불러오는 메소드 (key제외) |

### 에러처리

```java
try {
			boardService.hotplaceRegister(hotplaceDto);
		}catch (Exception e) {
			// TODO Auto-generated catch block
			e.printStackTrace();
			request.setAttribute("msg", "게시판 작성 중 에러 발생!!");
			return "./error.jsp";
		}
		return "./index.jsp";
```

직접 페이지를 만들어 log를 날리는 등 다양한 처리방법이 있음.

강의 중에는 예외처리를 통해 정확한 에러 정보는 서버에 출력하고 사용자에게는

어떤 일을 하던 중 에러가 났는지만 알리는 페이지를 만들었음.

에러코드

| 1~~ : 정보 |
| --- |
| 2~~ : 성공 |
| 3~~ : 리다이렉션 |
| 4~~ : 요청 |
| 5~~ : 서버 |

### **1XX 데이터의 처리중인 상태**

100: 데이터의 일부를 서버가 받은 상태

### **2XX : 정상적인 응답**

200: 에러 없이 정상처리

204: 정상처리 되었으나 서버에서 보내줄 데이터 없음

### **3XX : 다른 URL 처리**

301: 요청된 페이지가 새 URL로 변경되었음

304: 이미 기존의 데이터와 변경된 것이 없음

### **4XX: 서버에서 인식할 수 없음**

400: 전송된 Request에 문제가 있어서 서버에가 인식할 수 없음(올바른 요청을 보냈는지 검토)

**403**: 서버에서 요청을 거부함(클라이언트가 콘텐츠에 접근할 권리를 가지고 있지 않을 때)

**404:** 서버가 요청한 페이지를 찾을 수 없다(서버에 존재하지 않는 페이지에 대한 요청이 있을 경우)

406: 전송 방식이 허락되지 않음 (REST에서 자주 발생)

408 : 서버의 요청 대기가 시간을 초과

### **5XX: 서버 내부의 문제**

**500**: 서버에 오류가 발생하여 요청을 수행할 수 없음

502: 게이트웨이나 프록시 상태의 문제(과부하 등)

503: 일시적인 과부하나 서비스 중단 상태

504: 지정된 처리시간이 지나서 처리되지 못함(게이트웨이 시간 초과)

# JSP 구성 요소별 기능 및 사용법?

```java
<%!
out.println("<tr>");
for(int i ~~ ){
	out.println("<td>" + i + "</td>");
}
out.println("</tr>");
%>
```

[https://javacpro.tistory.com/44](https://javacpro.tistory.com/44)

# JSP 구문 EL로 변환하기, EL 연산자

```java
request.getParameter("name") => ${param.name} 
request.getAttribute("member") => ${member} 
  // 저장객체에 자동으로 접근하는데 page, request, session, application 순서로 접근

Member m = (Member)request.getAttribute("member");
m.get name => ${member.name} 

List l = (List)request.getAttribute("list");
l.get(0) => ${l["0"]}
```

| . | 자바빈 또는 맵에 접근하기 위한 연산자 |
| --- | --- |
| [] | 배열 또는 리스트에 접근하기 위한 연산자 |
| () | 연산할때 우선순위를 지정하는 연산자 |

그 외에는 자바와 동일한 연산자 개념

만약 변수명에 .(dot)이 들어가면 어떻게 해야하나?

```java
request.setAttribute("ssafy.user", memberDto);

${ssafy.user.name}4
// 에러남 ssafy 라는 속성은 없기 때문

${requestScope["ssafy.user"].name}
```

# JSTL import 및 사용

<c:import> : 지정된 URL을 태그가 사용된 JSP 페이지에 출력시키는 기능

```java
<c:import url="URL값" var="변수명" scope="범위" varReader="변수명"
  context="context명" charEncoding="인코딩값">
```

![Untitled](%E1%84%80%E1%85%AA%E1%84%91%E1%85%A7%E1%86%BC%20%E1%84%8C%E1%85%AE%E1%86%AB%E1%84%87%E1%85%B5%20092ebdc462c84b919ea45e889af4cfdc/Untitled%207.png)

![Untitled](%E1%84%80%E1%85%AA%E1%84%91%E1%85%A7%E1%86%BC%20%E1%84%8C%E1%85%AE%E1%86%AB%E1%84%87%E1%85%B5%20092ebdc462c84b919ea45e889af4cfdc/Untitled%208.png)

![Untitled](%E1%84%80%E1%85%AA%E1%84%91%E1%85%A7%E1%86%BC%20%E1%84%8C%E1%85%AE%E1%86%AB%E1%84%87%E1%85%B5%20092ebdc462c84b919ea45e889af4cfdc/Untitled%209.png)

![Untitled](%E1%84%80%E1%85%AA%E1%84%91%E1%85%A7%E1%86%BC%20%E1%84%8C%E1%85%AE%E1%86%AB%E1%84%87%E1%85%B5%20092ebdc462c84b919ea45e889af4cfdc/Untitled%2010.png)

![Untitled](%E1%84%80%E1%85%AA%E1%84%91%E1%85%A7%E1%86%BC%20%E1%84%8C%E1%85%AE%E1%86%AB%E1%84%87%E1%85%B5%20092ebdc462c84b919ea45e889af4cfdc/Untitled%2011.png)

```java
test.jsp
<%
pageContext.setAttribute("where", "pageContext");
request.setAttribute("where", "request");
session.setAttribute("where", "session");
application.setAttribute("where", "applicationContext");
%>

${where}
${initParam.where}
```

# 스코프

![Untitled](%E1%84%80%E1%85%AA%E1%84%91%E1%85%A7%E1%86%BC%20%E1%84%8C%E1%85%AE%E1%86%AB%E1%84%87%E1%85%B5%20092ebdc462c84b919ea45e889af4cfdc/Untitled%2012.png)

![Untitled](%E1%84%80%E1%85%AA%E1%84%91%E1%85%A7%E1%86%BC%20%E1%84%8C%E1%85%AE%E1%86%AB%E1%84%87%E1%85%B5%20092ebdc462c84b919ea45e889af4cfdc/Untitled%2013.png)

- EL 문법을 통해 접근 가능한 위치는 page, request, session, context, initContext(web.xml)이다.
- EL은 변수를 찾을 때 앞서의 순서에 따라 검색한다. page->request->session->context. 그러므로 변수를 선언할 때 그 이름을 정하는데 있어서 신경써야 한다.
- initContext(web.xml)의 경우 initParam을 그래프하여 호출한다.
- 앞서 JSTL을 통해 변수를 선언할 때<c:set> 기본 스코프는 page이다. 그러므로 앞서의 예제에서 ${listt}는 페이지에서 가지고 온 변수이다.
- JSP의 태그인 <jsp:usebean> 역시도 scope를 가진다. JSTL, EL과 마찬가지로 Servlet에 종속된다. 그러나 <jsp:useBean id="mem" class="bean.Member"></jsp:useBean>의 class 요소처럼,스크립트릿 없이 자바 소스에 접근 가능하다.

# 쿠키 & 세션

### Http 프로토콜의 특징

- client > 요청 > server > 처리 및 응답 > 연결 해제 = stateless
- 지속적인 연결로 인한 자원낭비를 줄이기 위해 연결을 해제.
- 로그인 정보등 연결 상태를 유지해야하는 상황도 존재.

### 쿠키 : javax.servlet.http.Cookie

- 서버에서 사용자의 컴퓨터에 저장하는 정보파일
- 별도의 요청 없이 브라우저는 request시 헤더를 넣어 자동으로 서버에 전송.
- key, value로 구성 String 형태
- 브라우저 마다 쿠키는 다르기에 다른 브라우저면 다른 사용자로 인식

### 사용 목적

- 세션관리 : 사용자 아이디, 접속시간, 장바구니 등의 서버가 알아야 할 정보 저장.
- 개인화 : 사용자마다 다르게 그 사람에게 적절한 페이지를 보여줄 수 있음.
- 트래킹 : 사용자의 행동과 패턴을 분석하고 기록.

### 쿠키 구성 요소

![Untitled](%E1%84%80%E1%85%AA%E1%84%91%E1%85%A7%E1%86%BC%20%E1%84%8C%E1%85%AE%E1%86%AB%E1%84%87%E1%85%B5%20092ebdc462c84b919ea45e889af4cfdc/Untitled%2014.png)

![Untitled](%E1%84%80%E1%85%AA%E1%84%91%E1%85%A7%E1%86%BC%20%E1%84%8C%E1%85%AE%E1%86%AB%E1%84%87%E1%85%B5%20092ebdc462c84b919ea45e889af4cfdc/Untitled%2015.png)

![Untitled](%E1%84%80%E1%85%AA%E1%84%91%E1%85%A7%E1%86%BC%20%E1%84%8C%E1%85%AE%E1%86%AB%E1%84%87%E1%85%B5%20092ebdc462c84b919ea45e889af4cfdc/Untitled%2016.png)

![Untitled](%E1%84%80%E1%85%AA%E1%84%91%E1%85%A7%E1%86%BC%20%E1%84%8C%E1%85%AE%E1%86%AB%E1%84%87%E1%85%B5%20092ebdc462c84b919ea45e889af4cfdc/Untitled%2017.png)

### 세션

![Untitled](%E1%84%80%E1%85%AA%E1%84%91%E1%85%A7%E1%86%BC%20%E1%84%8C%E1%85%AE%E1%86%AB%E1%84%87%E1%85%B5%20092ebdc462c84b919ea45e889af4cfdc/Untitled%2018.png)

![Untitled](%E1%84%80%E1%85%AA%E1%84%91%E1%85%A7%E1%86%BC%20%E1%84%8C%E1%85%AE%E1%86%AB%E1%84%87%E1%85%B5%20092ebdc462c84b919ea45e889af4cfdc/Untitled%2019.png)

![Untitled](%E1%84%80%E1%85%AA%E1%84%91%E1%85%A7%E1%86%BC%20%E1%84%8C%E1%85%AE%E1%86%AB%E1%84%87%E1%85%B5%20092ebdc462c84b919ea45e889af4cfdc/Untitled%2020.png)

![Untitled](%E1%84%80%E1%85%AA%E1%84%91%E1%85%A7%E1%86%BC%20%E1%84%8C%E1%85%AE%E1%86%AB%E1%84%87%E1%85%B5%20092ebdc462c84b919ea45e889af4cfdc/Untitled%2021.png)

![Untitled](%E1%84%80%E1%85%AA%E1%84%91%E1%85%A7%E1%86%BC%20%E1%84%8C%E1%85%AE%E1%86%AB%E1%84%87%E1%85%B5%20092ebdc462c84b919ea45e889af4cfdc/Untitled%2022.png)

# MVC Pattern

![Untitled](%E1%84%80%E1%85%AA%E1%84%91%E1%85%A7%E1%86%BC%20%E1%84%8C%E1%85%AE%E1%86%AB%E1%84%87%E1%85%B5%20092ebdc462c84b919ea45e889af4cfdc/Untitled%2023.png)

![Untitled](%E1%84%80%E1%85%AA%E1%84%91%E1%85%A7%E1%86%BC%20%E1%84%8C%E1%85%AE%E1%86%AB%E1%84%87%E1%85%B5%20092ebdc462c84b919ea45e889af4cfdc/Untitled%2024.png)

![Untitled](%E1%84%80%E1%85%AA%E1%84%91%E1%85%A7%E1%86%BC%20%E1%84%8C%E1%85%AE%E1%86%AB%E1%84%87%E1%85%B5%20092ebdc462c84b919ea45e889af4cfdc/Untitled%2025.png)

![Untitled](%E1%84%80%E1%85%AA%E1%84%91%E1%85%A7%E1%86%BC%20%E1%84%8C%E1%85%AE%E1%86%AB%E1%84%87%E1%85%B5%20092ebdc462c84b919ea45e889af4cfdc/Untitled%2026.png)

![Untitled](%E1%84%80%E1%85%AA%E1%84%91%E1%85%A7%E1%86%BC%20%E1%84%8C%E1%85%AE%E1%86%AB%E1%84%87%E1%85%B5%20092ebdc462c84b919ea45e889af4cfdc/Untitled%2027.png)

![Untitled](%E1%84%80%E1%85%AA%E1%84%91%E1%85%A7%E1%86%BC%20%E1%84%8C%E1%85%AE%E1%86%AB%E1%84%87%E1%85%B5%20092ebdc462c84b919ea45e889af4cfdc/Untitled%2028.png)

# forward? sendRedirect?

- forward 방식: 웹 컨테이너 차원의 페이지 이동, 웹 브라우저는 다른 페이지로 이동했음을 알 수 없고, 브라우저에 최초 호출한 URL이 표시된다.
1. 최초 요청 (클라이언트 -> request -> URL 1)
2. forward (URL 1 -> forward -> URL 2)
3. 응답 (URL 2 -> response -> 클라이언트)
- redirect 방식: 다른 웹 컨테이너에 있는 주소로 이동 가능, 웹 브라우저는 URL을 지시된 주소로 바꾸고 그 주소로 이동
1. 최초 요청 (클라이언트 -> request 1 -> URL 1)
2. redirect할 새로운 URL 2 리턴 (URL 1 -> redirect -> 클라이언트)
3. URL 2 요청 (클라이언트 -> request 2 -> URL 2)
4. 응답 (URL 2 -> response -> 클라이언트)

(이 때, 요청 1과 요청 2는 서로 다르며, 각자 새로운 요청을 수행한다.)

| forward 방식 | sendRedirect 방식 |
| --- | --- |
| JSP 액션 태그이다. | JSP 내장 객체이다. (response) |
| 요청 정보가 유지된다. | 새로운 요청이 수행된다. |
| URL이 변화하지 않는다. | URL이 변화한다. |
| 객체를 재사용한다. | 객체를 재사용하지 않는다. (새로운 요청) |
| 시스템 변화가 생기지않는 요청에 적합 (검색 등의 단순 조회) | 시스템 변화가 생기는 요청에 적합 (로그인, 글쓰기 등) |

```java
void redirect(HttpServletRequest request, HttpServletResponse response, String path) throws IOException {
		response.sendRedirect(path);
	}

void forward(HttpServletRequest request, HttpServletResponse response, String path)
		throws ServletException, IOException {
	RequestDispatcher dispatcher = request.getRequestDispatcher(path);
	dispatcher.forward(request, response);
}
```
